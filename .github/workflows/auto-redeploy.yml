name: Scheduled Auto-Redeploy

on:
  schedule:
    - cron: '0 */4 * * *' # Runs every 4 hours at minute 0
  workflow_dispatch: # Allows manual triggering from GitHub Actions tab

permissions:
  contents: read

jobs:
  trigger-deploy:
    runs-on: ubuntu-latest
    env:
      RENDER_DEPLOY_HOOK: ${{ secrets.RENDER_DEPLOY_HOOK }}
    steps:
      - name: Trigger Render Deploy Hook
        if: env.RENDER_DEPLOY_HOOK != ''
        run: |
          curl -X POST "$RENDER_DEPLOY_HOOK"
          echo "Triggered deploy hook successfully."

      - name: Check for Secret
        if: env.RENDER_DEPLOY_HOOK == ''
        run: |
          echo "::error::Secret RENDER_DEPLOY_HOOK is missing! Please add it as a secret in GitHub Repository Settings > Secrets and variables > Actions."
          exit 1
